---
import BaseLayout from '@/layouts/BaseLayout.astro'
import RichText from '@/components/RichText.astro'
import Button from '@/components/ui/Button.astro'
import Card from '@/components/ui/Card.astro'
import { sanity } from '../lib/sanity'
import { pageBySlugQuery, siteSettingsQuery } from '../lib/sanityQueries'

const settings = sanity ? await sanity.fetch(siteSettingsQuery) : null
const homeSlug = settings?.homeSlug || 'home'
const home = sanity ? await sanity.fetch(pageBySlugQuery, { slug: homeSlug }) : null
---

<BaseLayout title={home?.title || settings?.title || 'Home'}>
  {
    home ? (
      <>
        <header class="space-y-3">
          <h1 class="text-5xl tracking-tight">{home.title}</h1>
        </header>
        <Card tone="surface" class="mt-6">
          <RichText value={home.content} />
        </Card>
        <div class="mt-8">
          <Button href="/work" variant="secondary">
            View work
          </Button>
        </div>
      </>
    ) : (
      <Card tone="surface">
        <h1 class="text-4xl tracking-tight">Ramu</h1>
        <p class="mt-3 text-muted">
          Add Sanity env vars and publish a page with slug: <code>home</code>.
        </p>
      </Card>
    )
  }
</BaseLayout>
