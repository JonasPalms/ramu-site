---
import { cn } from '@/utils/cn'

type Variant = 'primary' | 'outline' | 'link'
type Size = 'sm' | 'md'

type Props = {
  href?: string
  target?: string
  rel?: string
  type?: 'button' | 'submit' | 'reset'
  variant?: Variant
  size?: Size
  class?: string
}

const {
  href,
  target,
  rel,
  type = 'button',
  variant = 'primary',
  size = 'md',
  class: className,
} = Astro.props as Props

const base =
  'inline-flex items-center justify-center gap-2 rounded-[var(--site-radius-button)] font-medium focus:outline-none focus:ring-2 focus:ring-focus-ring'

const sizeClass = size === 'sm' ? 'px-4 py-1.5 text-sm' : 'px-5 py-2 text-sm'

const variantClass =
  variant === 'primary'
    ? 'bg-button-primary-bg text-button-primary-fg hover:bg-button-primary-hover'
    : variant === 'outline'
      ? 'border border-button-outline-border bg-button-outline-bg text-button-outline-fg hover:bg-button-outline-hover'
      : 'text-interactive underline underline-offset-4 hover:text-interactive-active focus:ring-0'

const classes = cn(base, sizeClass, variantClass, className)

const isExternal = href && (href.startsWith('http://') || href.startsWith('https://'))
const resolvedRel = rel ?? (isExternal ? 'noopener noreferrer' : undefined)
const resolvedTarget = target ?? (isExternal ? '_blank' : undefined)
---

{
  href ? (
    <a class={classes} href={href} rel={resolvedRel} target={resolvedTarget}>
      <slot />
    </a>
  ) : (
    <button class={classes} type={type}>
      <slot />
    </button>
  )
}
