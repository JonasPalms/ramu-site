---
import BaseLayout from '@/layouts/BaseLayout.astro'
import RichText from '@/components/RichText.astro'
import Card from '@/components/ui/Card.astro'
import Container from '@/components/layout/Container.astro'
import { sanity } from '@/lib/sanity'
import { allPageSlugsQuery, pageBySlugQuery } from '@/lib/sanityQueries'

export async function getStaticPaths() {
  if (!sanity) return []
  const pages = await sanity.fetch<{ slug: string }[]>(allPageSlugsQuery)
  return pages.filter((p) => p.slug && p.slug !== 'home').map((p) => ({ params: { slug: p.slug } }))
}

const { slug } = Astro.params
const page = sanity ? await sanity.fetch(pageBySlugQuery, { slug }) : null
---

<BaseLayout title={page?.title || slug}>
  <Container class="space-y-6">
    <header class="space-y-3">
      <h1 class="text-4xl tracking-tight">{page?.title}</h1>
    </header>
    <Card tone="surface">
      <RichText value={page?.content} />
    </Card>
  </Container>
</BaseLayout>
