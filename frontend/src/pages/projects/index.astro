---
import BaseLayout from '@/layouts/BaseLayout.astro'
import RichText from '@/components/RichText.astro'
import Button from '@/components/ui/Button.astro'
import Card from '@/components/ui/Card.astro'
import Container from '@/components/layout/Container.astro'
import { sanity } from '@/lib/sanity'
import { projectsIndexQuery, projectsPageQuery } from '@/lib/sanityQueries'

const projectsPage = sanity ? await sanity.fetch<any>(projectsPageQuery) : null
const projects = sanity ? await sanity.fetch<any[]>(projectsIndexQuery) : []
---

<BaseLayout title={projectsPage?.seo?.metaTitle || projectsPage?.title || 'Projects'}>
  <Container class="space-y-6">
    <header class="space-y-3">
      <h1 class="text-4xl tracking-tight">{projectsPage?.title || 'Projects'}</h1>
      {
        projectsPage?.intro ? (
          <Card tone="background">
            <RichText value={projectsPage.intro} />
          </Card>
        ) : (
          <p class="text-muted">Selected projects and films.</p>
        )
      }
    </header>

    <div class="grid gap-4">
      {
        projects.length ? (
          <>
            {projects.map((p) => (
              <Card as="article" tone="surface" class="flex items-start justify-between gap-6">
                <div class="min-w-0">
                  <h2 class="text-xl tracking-tight">{p.title}</h2>
                  <p class="mt-2 text-sm text-muted">{p.year ? p.year : 'â€”'}</p>
                </div>
                <div class="shrink-0">
                  <Button href={`/projects/${p.slug}`} variant="outline" size="sm">
                    View
                  </Button>
                </div>
              </Card>
            ))}
          </>
        ) : (
          <Card tone="background">
            <p class="text-muted">No projects yet.</p>
          </Card>
        )
      }
    </div>
  </Container>
</BaseLayout>
