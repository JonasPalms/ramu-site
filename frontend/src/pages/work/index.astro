---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Button from '@/components/ui/Button.astro'
import Card from '@/components/ui/Card.astro'
import Container from '@/components/layout/Container.astro'
import { sanity } from '@/lib/sanity'
import { projectsIndexQuery } from '@/lib/sanityQueries'

const projects = sanity ? await sanity.fetch<any[]>(projectsIndexQuery) : []
---

<BaseLayout title="Work">
  <Container>
    <header class="space-y-3">
      <h1 class="text-4xl tracking-tight">Work</h1>
      <p class="text-muted">Selected projects and films.</p>
    </header>

    <div class="mt-10 grid gap-4">
      {
        projects.length ? (
          <>
            {projects.map((p) => (
              <Card as="article" tone="surface" class="flex items-start justify-between gap-6">
                <div class="min-w-0">
                  <h2 class="text-xl tracking-tight">{p.title}</h2>
                  <p class="mt-2 text-sm text-muted">{p.year ? p.year : 'â€”'}</p>
                </div>
                <div class="shrink-0">
                  <Button href={`/work/${p.slug}`} variant="outline" size="sm">
                    View
                  </Button>
                </div>
              </Card>
            ))}
          </>
        ) : (
          <Card tone="background">
            <p class="text-muted">No projects yet.</p>
          </Card>
        )
      }
    </div>
  </Container>
</BaseLayout>
